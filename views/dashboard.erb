
<div class="job-text">
  <div class="job-text-details">
    <span class="close">&times;</span>
    <div class="text-msg-content"></div>
  </div>
</div>

<main class="dashboard">
  <section class="stats">
    <div class="stat working">
      <h2><%= Job.working.count %></h2>
      <h4>working</h4>
    </div>
    <div class="stat unfilled">
    <h2><%= Job.unfilled.count %></h2>
      <h4>unfilled jobs</h4>
    </div>
    <div class="stat available">
      <h2><%= Worker.available.count %></h2>
      <h4>available workers</h4>
    </div>
  </section>

  <section class="unassigned-workers">
    <h1>There are <%= @unassigned.count %> new workers </h1>
    <% if @unassigned %>
    <ul>
      <% @unassigned.each do | worker |%>
      <li class="unassigned-workers">
        <p><%= "#{worker.full_name} | #{worker.worker_type} | #{worker.available? ? 'Available' : 'Not Available'}" %></p>
        <form action="/workers/claim" method="post">
          <input type="hidden" name="worker_id" value="<%= worker.id %>">
          <button>Claim Worker</button>
        </form>
      </li>
      <% end %>
    </ul>
  <% end %>
  </section>

  <section class="unfilled-job-section">
  <h1>UNFILLED JOBS</h1>
  <% if @unfilled %>
    <ul>
      <% @unfilled.each do | job |%>
      <li class="unfilled-job">
        <p><%= "#{job.project.client.name} | #{job.project.name} | #{job.worker_type} | #{job.start_date.strftime("%d/%m/%Y")} | #{job.start_time.strftime("%H:%M")}" %></p>

        </div>
        <button class="job-text-btn">
          Job Text
          <div class="hidden-text">
            <p><%="For #{job.start_date.strftime('%A %d/%m/%Y')}:"%></p>
            <p><%="#{job.project.client.name}"%></p>
            <p><%="Address: #{job.project.address1}, #{job.project.city}"%></p>
            <p><%="Contact: #{job.project.client_contact.full_name}: #{job.project.client_contact.phone}"%></p>
            <p><%="Start Time: #{job.start_time.strftime("%H:%M %p")} (Please arrive 15mins beforehand)"%></p>
            <p>Full PPE and White Card</p>
            <p>Can you confirm this is ok?</p>
          </div>
        </button>

        <form action="/jobs/<%= job.id %>/add_worker" method="post">
        <input type="hidden" name="_method" value="put">
          <select name="worker_id">
            <% if job.worker_type == "Labourer" %>
              <% @avail_labourers.each do |worker| %>
                <option value="<%= worker.id %>"><%= worker.full_name %></option>
              <% end %>
            <% elsif job.worker_type == "Ticketed" %>
              <% @avail_ticketed.each do |worker| %>
                <option value="<%= worker.id %>"><%= worker.full_name %></option>
              <% end %>
            <% elsif job.worker_type == "Carpenter" %>
              <% @avail_carpenters.each do |worker| %>
                <option value="<%= worker.id %>"><%= worker.full_name %></option>
              <% end %>
          <% end %>
          </select>
          
          <button>Assign Worker</button>
        </form>
      </li>
      <% end %>
    </ul>
  <% end %>
  </section>


  <section class="filled-job-section">
  <h1>FILLED JOBS</h1>
  <% if @filled %>
    <ul>
      <% @filled.each do | job |%>
      <li class="filled-job">
        <p><%= "#{job.project.client.name} | #{job.project.name} | #{job.worker_type} | #{job.start_date.strftime("%d/%m/%Y")} | #{job.start_time.strftime("%H:%M")} | #{job.worker.full_name}" %></p>
        <div>
          <form action="/jobs/<%= job.id %>/remove_worker" method="post">
            <input type="hidden" name="_method" value="put">          
            <button>Remove Worker</button>
          </form>
          <form action="/jobs/<%= job.id %>/working" method="post">
            <input type="hidden" name="_method" value="put">          
            <button>Working</button>
          </form>
          <form action="/jobs/<%= job.id %>" method="post">
            <input type="hidden" name="_method" value="delete">          
            <button>Cancelled</button>
          </form>
        </div>
      </li>
      <% end %>
    </ul>
  <% end %>
</section>

<section class="working-job-section">
  <h1>WORKING JOBS</h1>
  <% if @working_jobs %>
    <ul>
      <% @working_jobs.each do | job |%>
      <li class="working-job">
        <p><%= "#{job.project.client.name} | #{job.project.name} | #{job.worker_type} | #{job.start_date.strftime("%d/%m/%Y")} | #{job.worker.full_name}" %></p>
        <form action="/jobs/<%= job.id %>/finished" method="post">
          <input type="hidden" name="_method" value="put">          
          <button>Finished</button>
        </form>
      </li>
      <% end %>
    </ul>
  <% end %>
</section>
